#!/bin/bash

echo "ðŸ“¦ Ø¯Ø± Ø­Ø§Ù„ Ù†ØµØ¨ PurWin GUI ..."

# Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
echo "ðŸ Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ†..."
pip3 install --break-system-packages customtkinter psutil Pillow

# Ø³Ø§Ø®Øª Ù…Ø³ÛŒØ± Ù†ØµØ¨
sudo mkdir -p /opt/purwin
sudo cp main.py purwint icon.png /opt/purwin/
sudo chmod +x /opt/purwin/main.py /opt/purwin/purwint

# Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„ policykit Ø¨Ø±Ø§ÛŒ pkexec
echo "ðŸ” Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª PolicyKit..."
sudo tee /usr/share/polkit-1/actions/com.purwin.gui.policy > /dev/null <<EOF
<?xml version="1.0" encoding="UTF-8"?>
<policyconfig>
  <action id="com.purwin.gui">
    <description>Run PurWin GUI as root</description>
    <message>Authentication is required to run PurWin GUI</message>
    <defaults>
      <allow_any>auth_admin</allow_any>
      <allow_inactive>auth_admin</allow_inactive>
      <allow_active>auth_admin</allow_active>
    </defaults>
    <annotate key="org.freedesktop.policykit.exec.path">/usr/bin/python3</annotate>
    <annotate key="org.freedesktop.policykit.exec.argv1">/opt/purwin/main.py</annotate>
  </action>
</policyconfig>
EOF

# Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„ desktop
echo "ðŸ–¥ï¸ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª Ø´ÙˆØ±ØªÚ©Ø§Øª Ø¯Ø³Ú©ØªØ§Ù¾..."
tee ~/.local/share/applications/purwin.desktop > /dev/null <<EOF
[Desktop Entry]
Name=PurWin GUI
Exec=pkexec python3 /opt/purwin/main.py
Icon=/opt/purwin/icon.png
Terminal=false
Type=Application
Categories=Utility;
EOF

chmod +x ~/.local/share/applications/purwin.desktop

# Ú©Ù¾ÛŒ Ø±ÙˆÛŒ Ø¯Ø³Ú©ØªØ§Ù¾
cp ~/.local/share/applications/purwin.desktop ~/Desktop/
chmod +x ~/Desktop/purwin.desktop

echo "âœ… Ù†ØµØ¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø¢ÛŒÚ©ÙˆÙ† Ø±ÙˆÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯."
